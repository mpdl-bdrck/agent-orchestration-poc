# PNP-000: Verify Chainlit CustomElement API Before Implementation

**Status**: ðŸ”´ To Do  
**Phase**: Prerequisite - API Verification  
**Priority**: Critical  
**Assignee**: TBD

---

## Description

Before implementing the notification panel, we must verify the correct Chainlit CustomElement API usage. The previous implementation attempt failed because the plan documented incorrect API calls that don't match Chainlit's actual API.

## Problem Statement

The implementation plan documents incorrect API usage:
- `await panel.send()` - This method requires a `for_id` parameter (message ID)
- `await panel.update(props={...})` - This method takes no parameters; props must be set separately

These errors caused:
1. Panel initialization to fail
2. Potential cascading failures that affected avatar loading
3. Complete feature failure requiring git reset

## Acceptance Criteria

- [ ] Create a test script to verify Chainlit CustomElement API
- [ ] Document correct API for:
  - [ ] Creating CustomElement
  - [ ] Sending/displaying CustomElement
  - [ ] Updating CustomElement props
  - [ ] Error handling patterns
- [ ] Verify CustomElement can be displayed in sidebar (`display="side"`)
- [ ] Test CustomElement update mechanism
- [ ] Document any limitations or gotchas
- [ ] Update implementation plan with correct API usage
- [ ] Ensure error isolation (panel failures don't break avatars)

## Test Script Requirements

Create `tools/tests/test_chainlit_custom_element.py`:

```python
"""
Test script to verify Chainlit CustomElement API before implementation.
Run this BEFORE implementing the notification panel to ensure correct API usage.
"""
import chainlit as cl

# Test 1: Check CustomElement class signature
print("=== CustomElement API ===")
help(cl.CustomElement)

# Test 2: Check send() method signature
print("\n=== CustomElement.send() API ===")
try:
    help(cl.CustomElement.send)
except Exception as e:
    print(f"Error: {e}")

# Test 3: Check update() method signature
print("\n=== CustomElement.update() API ===")
try:
    help(cl.CustomElement.update)
except Exception as e:
    print(f"Error: {e}")

# Test 4: Verify Message attachment pattern
print("\n=== Message + CustomElement Pattern ===")
# Document how to attach CustomElement to Message
```

## Related Files

- `plans/proactive-notification-panel/proactive-notification-panel-implementation.md` (needs API correction)
- `docs/features/PROACTIVE_NOTIFICATION_PANEL.md` (needs API correction)
- `tools/tests/test_chainlit_custom_element.py` (to be created)

## Dependencies

None - This is a prerequisite for all other tickets.

## Notes

**Critical**: This ticket MUST be completed before starting PNP-001. All subsequent implementation depends on having the correct API documentation.

**Why This Matters**:
- Incorrect API usage caused complete feature failure
- Avatar system was potentially affected due to error propagation
- Proper error isolation requires understanding the API first

**Expected Outcomes**:
- Clear documentation of correct Chainlit CustomElement API
- Test script that validates API usage
- Updated plan with correct code examples
- Confidence that implementation will work before starting

---

**Created**: December 2, 2025  
**Reason**: Post-mortem analysis revealed incorrect API documentation in plan

