# PNP-009: Format Alerts as JSON Payloads

**Status**: ğŸ”´ To Do  
**Phase**: Phase 2 - Backend Logic (The Data Source)  
**Priority**: High  
**Assignee**: TBD

---

## Description

Create helper function `_send_notification_message()` that formats alerts as JSON payloads for transport.

## Acceptance Criteria

- [ ] Function `_send_notification_message(alert: dict)` exists in `handlers.py`
- [ ] Maps alert fields to card data structure:
  - [ ] `agent` â†’ capitalized agent name
  - [ ] `agent` â†’ emoji icon (ğŸ›¡ï¸, ğŸ”§, ğŸ¯, ğŸ§­)
  - [ ] `severity` â†’ severity level
  - [ ] `message` â†’ alert message
  - [ ] Builds `context` string from alert data
- [ ] Formats context as: "Investigate {issue_type} for {entity_id}. {details}"
- [ ] Creates JSON payload dictionary
- [ ] Wraps JSON in code block (```json ... ```)
- [ ] Sends message via `cl.Message` with `author="__NOTIFY__"`
- [ ] Logs alert send events

## Related Files

- `src/interface/chainlit/handlers.py` (add new function)

## Dependencies

- PNP-007 (Background monitor function)

## Notes

This function transforms alert data into the format expected by the JavaScript card renderer. See implementation plan section "3. Backend: Background Monitor" for payload structure.
